<VirtualHost *:80>
    ServerName your-domain.com
    ServerAdmin webmaster@your-domain.com

    DocumentRoot /var/www/retrieva/frontend/build
    <Directory /var/www/retrieva/frontend/build>
        Options FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # React SPA fallback so client-side routing works
    RewriteEngine On
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^ /index.html [L]

    # Reverse proxy to Express backend running on 127.0.0.1:5000
    ProxyPreserveHost On
    ProxyRequests Off
    ProxyPass /api/ http://127.0.0.1:5000/
    ProxyPassReverse /api/ http://127.0.0.1:5000/

    # Basic security headers
    Header always set X-Content-Type-Options "nosniff"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"

    ErrorLog ${APACHE_LOG_DIR}/retrieva-error.log
    CustomLog ${APACHE_LOG_DIR}/retrieva-access.log combined
</VirtualHost>
